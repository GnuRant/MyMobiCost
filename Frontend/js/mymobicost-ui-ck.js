//===============================================================
//==========================  UI ================================
//===============================================================
//===============================================================
//========================= UTILITY =============================
//===============================================================
"use strict";function toggle_active_menu(e){$(".active").toggleClass("active");$(e).toggleClass("active")}function load_partial(e,t,n){$.get(e,function(e){$(t).html(e).ready(n())})}function increment_inpunt_value(){$(".tagsinput-add").on("click",function(e){var t=$(this),n=t.parent().find("input"),r=n.val();r===""&&(r=0);n.val(++r);$(".form-campi").data("bootstrapValidator").validate()})}function decrement_input_value(){$(".tagsinput-remove").on("click",function(e){var t=$(this),n=t.parent().find("input"),r=n.val();r===""&&(r=0);--r>=0&&n.val(r);$(".form-campi").data("bootstrapValidator").validate()})}function generete_id(){return((1+Math.random())*65536|0).toString(16).substring(1)}function reset_form(e){$(e)[0].reset();reset_drop_down("select")}function reset_drop_down(e){$(e).val(0).change()}function reset_drop_down_hard(e){$(e).find("option").remove().end().append('<option value="0" disabled selected>seleziona un\'opzione</option>').val("whatever")}function open_form_sidebar(){$(".categoria").show();$("#logo").addClass("logo-deactive");$("#new-session").addClass("new-session-active");$("#form-container").addClass("form-container-open");$("#content-pusher").addClass("pusher-open");$(".overlay").show();$(".overlay").css("opacity","0.7");load_form_famiglia()}function close_form_sidebar(){$(".categoria").hide();$("#logo").removeClass("logo-deactive");$("#new-session").removeClass("new-session-active");$("#form-container").removeClass("form-container-open");$("#content-pusher").removeClass("pusher-open");$(".overlay").css("opacity","0");$(".overlay").hide()}function new_session(){$("#welcome").hide();open_form_sidebar()}function load_form_famiglia(){toggle_active_menu("#menu-famiglia-button");load_partial("partials/famiglia.html","#form-container",function(){form_famiglia()})}function form_famiglia(){$(".form-campi").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"}});increment_inpunt_value();decrement_input_value();$("label").tooltip();load_famiglia_data();$("#famiglia-avanti").click(function(){$(".form-campi").data("bootstrapValidator").validate();if($(".form-campi").data("bootstrapValidator").isValid()){var e={};$.each($("#famiglia-caller").serializeArray(),function(t,n){e[n.name]=n.value});user_current_data.famiglia=e;load_form_abitazione()}})}function load_famiglia_data(){var e=user_current_data.famiglia;if(!$.isEmptyObject(e)){$("input[name=adulti]").val(e.adulti);$("input[name=bambini]").val(e.bambini)}}function load_form_abitazione(){toggle_active_menu("#menu-abitazione-button");load_partial("partials/abitazione.html","#form-container",function(){form_abitazione()})}function form_abitazione(){$(".form-campi").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"}});$("label").tooltip();$("select").selectpicker({style:"btn-hg btn-primary",menuStyle:"dropdown-inverse"});$(".switch").bootstrapSwitch();$(function(){$("#checkbox-abitazione").change(function(){$("#costo-sconosciuto").toggle(!this.checked);$("#costo-conosciuto").toggle(this.checked)}).change()});load_abitazione_data();$("input[name=grandezza]").change(function(){isNaN($("input[name=grandezza]").val())||set_input_costi()});get_comuni(function(e){$.each(e,function(e,t){$("select[name=comune]").append("<option>"+t+"</option>")})});$("select[name=comune]").change(function(){comune=$("select[name=comune]").val();get_zone(comune,function(e){$.each(e,function(e,t){$("select[name=zona_abitativa]").append("<option value="+t.code+">"+t.zona+"</option>")})});get_costi_med_comuni($("select[name=comune]").val(),function(e){update_values_costi(e)});reset_drop_down_hard("select[name=zona_abitativa]");reset_drop_down_hard("select[name=categoria_edilizia]")});$("select[name=zona_abitativa]").change(function(){zona=$("select[name=zona_abitativa]").val();get_categoria_edilizia(comune,zona,function(e){$.each(e,function(e,t){$("select[name=categoria_edilizia]").append("<option value="+t.code+">"+t.tipologia+"</option>")})});reset_drop_down("select[name=categoria_edilizia]")});$("select[name=categoria_edilizia]").change(function(){categoria=$("select[name=categoria_edilizia]").val();get_costi_totali(comune,zona,categoria,function(e){update_values_costi(e)})});$("#abitazione-avanti").click(function(){$(".form-campi").data("bootstrapValidator").validate();if($(".form-campi").data("bootstrapValidator").isValid()){var e={};$.each($("#abitazione-caller").serializeArray(),function(t,n){e[n.name]=n.value});e.state=$("#checkbox-abitazione").is(":checked");if(e.state===!1){var t=e.comune,n=$("select[name=zona_abitativa]").find(":selected").text(),r=$("select[name=categoria_edilizia]").find(":selected").text();e.indirizzo=t+", "+n+" - "+r}else e.indirizzo="Abitazione Propria";user_current_data.abitazione=e;load_form_trasporti()}})}function update_values_costi(e){costo_min=e.cost_min;costo_max=e.cost_max;costo=e.cost_med;set_input_costi()}function set_input_costi(){var e=$("input[name=grandezza]").val();$("input[name=costo_min]").val((e*costo_min).toFixed(2));$("input[name=costo_max]").val((e*costo_max).toFixed(2));$("input[name=cost_med]").val((e*costo).toFixed(2))}function load_abitazione_data(){var e;if(!$.isEmptyObject(user_current_data.abitazione)){e=user_current_data.abitazione;if(e.state===!1){comune=e.comune;zona=e.zona_abitativa;categoria=e.categoria_edilizia;$("input[name=grandezza]").val(e.grandezza);get_comuni(function(e){$.each(e,function(e,t){$("select[name=comune]").append("<option>"+t+"</option>");$("select[name=comune]").val(comune)})});get_zone(comune,function(e){$.each(e,function(e,t){$("select[name=zona_abitativa]").append("<option value="+t.code+">"+t.zona+"</option>")});$("select[name=zona_abitativa]").val(zona)});get_categoria_edilizia(comune,zona,function(e){$.each(e,function(e,t){$("select[name=categoria_edilizia]").append("<option value="+t.code+">"+t.tipologia+"</option>")});$("select[name=categoria_edilizia]").val(categoria)});$("input[name=cost_med]").val(e.cost_med);$("input[name=costo_min]").val(e.costo_min);$("input[name=costo_max]").val(e.costo_max)}else{$(".switch").bootstrapSwitch("setState",!0);$("input[name=cost_med]").val(e.cost_med)}}}function load_form_trasporti(){toggle_active_menu("#menu-trasporti-button");load_partial("partials/trasporti.html","#form-container",function(){form_trasporti()})}function form_trasporti(){$("#auto-caller").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"}});$("#abbonamenti-caller").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"}});$("label").tooltip();$("select").selectpicker({style:"btn-hg btn-primary",menuStyle:"dropdown-inverse"});$(".switch").bootstrapSwitch();load_automobili_data();load_abbonamenti_data();user_current_data.automobili=array_auto;user_current_data.abbonamenti=array_abbonamenti;$("#bottone-aggiungi-auto").click(function(){$("#aggiungi-auto").show();$("input[name=auto_nome]").val("Auto "+(array_auto.length+1));reset_form("#auto-container")});$("#bottone-aggiungi-abbonamento").click(function(){$("#aggiungi-abbonamento").show()});get_auto_categorie(function(e){$.each(e,function(e,t){$("select[name=classe]").append("<option>"+t+"</option>")})});$("select[name=classe]").change(function(){classe=$("select[name=classe]").val();reset_drop_down_hard("select[name=alimentazione]");get_auto_alimentazione(classe,function(e){$.each(e,function(e,t){$("select[name=alimentazione]").append("<option>"+t+"</option>")})})});$("select[name=alimentazione]").change(function(){alimentazione=$("select[name=alimentazione]").val();get_auto_costi(classe,alimentazione,function(e){$("input[name=assicurazione]").val(e.assicurazione);$("input[name=costo_km]").val(e.costo_km);$("input[name=costo_fisso]").val(e.costo_fisso_altro)})});$("#save-auto").click(function(){$("#auto-caller").data("bootstrapValidator").validate();if($("#auto-caller").data("bootstrapValidator").isValid()){var e={};$.each($("#auto-caller").serializeArray(),function(t,n){e[n.name]=n.value});e.id_auto=generete_id();if(edit_mode){$("#"+old_auto_id).remove();$.each(array_auto,function(e,t){t.id_auto==old_auto_id&&array_auto.splice(array_auto.indexOf(t),1)});edit_mode=!1}array_auto.push(e);add_automobile(e);$("#aggiungi-auto").hide();reset_form("#auto-caller")}});$("#cancel-auto").click(function(){$("#aggiungi-auto").hide();reset_form("#auto-caller");edit_mode=!1;old_auto_id=""});$("#save-abbonamento").click(function(){$("#abbonamenti-caller").data("bootstrapValidator").validate();if($("#abbonamenti-caller").data("bootstrapValidator").isValid()){var e={};$.each($("#abbonamenti-caller").serializeArray(),function(t,n){e[n.name]=n.value});e.id_abbonamento=generete_id();if(edit_mode){$("#"+old_abbonamento_id).remove();console.log(old_abbonamento_id);$.each(array_abbonamenti,function(e,t){t.id_abbonamento==old_abbonamento_id&&array_abbonamenti.splice(array_abbonamenti.indexOf(t),1)});edit_mode=!1}array_abbonamenti.push(e);add_abbonamento(e);$("#aggiungi-abbonamento").hide();reset_form("#abbonamenti-caller")}});$("#cancel-abbonamento").click(function(){$("#aggiungi-abbonamento").hide();edit_mode=!1;old_abbonamento_id="";reset_form("#abbonamenti-caller")});$("#trasporti-avanti").click(function(){(array_auto.length>0||array_abbonamenti.length>0)&&load_form_spostamenti()})}function add_automobile(e){var t=e.id_auto,n="<div id='"+t+"' class='tabella-auto'>                         <div class='icon-auto'></div>                         <h3 class='nome-auto'>"+e.auto_nome+"</h3>                         <p>"+e.percorrenza_annua+" km annuali</p>                         <div class='modifica-auto'>                             <span class='fui-new'></span>                             <span class='fui-cross'></span>                         </div>                       </div>";$("#auto-container").append(n);$(".fui-cross").click(function(e){var t=$(this),n=t.parents(".tabella-auto:first").attr("id");$("#"+n).remove();$.each(array_auto,function(e,t){t.id_auto==n&&array_auto.splice(array_auto.indexOf(t),1)})});$(".fui-new").click(function(e){var t=$(this),n=t.parents(".tabella-auto:first").attr("id");$.each(array_auto,function(e,t){if(t.id_auto==n){load_form_automobile_data(array_auto[array_auto.indexOf(t)]);edit_mode=!0;old_auto_id=t.id_auto}})})}function load_automobili_data(){if(!$.isEmptyObject(user_current_data.automobili)){array_auto=user_current_data.automobili;$.each(array_auto,function(e,t){add_automobile(t)})}}function load_form_automobile_data(e){$("input[name=abbonamento_parcheggio]").val(e.abbonamento_parcheggio).change();$("input[name=auto_nome]").val(e.auto_nome).change();$("input[name=percorrenza_annua]").val(e.percorrenza_annua).change();$("input[name=pedaggio_autostradale]").val(e.pedaggio_autostradale).change();$("input[name=assicurazione]").val(e.assicurazione).change();$("input[name=costo_km]").val(e.costo_km).change();$("input[name=costo_fisso]").val(e.costo_fisso).change();classe=e.classe;get_auto_categorie(function(e){$.each(e,function(e,t){$("select[name=classe]").append("<option>"+t+"</option>")});$("select[name=classe]").val(classe)});alimentazione=e.alimentazione;get_auto_alimentazione(classe,function(e){$.each(e,function(e,t){$("select[name=alimentazione]").append("<option>"+t+"</option>")});$("select[name=alimentazione]").val(alimentazione)});$("#aggiungi-auto").show()}function add_abbonamento(e){var t="<div id='"+e.id_abbonamento+"' class='tabella-mezzo'>                                 <div class='icon-mezzo'></div>                                   <h3 class='nome-mezzo'>"+e.abbonamento_nome+"</h3>                                   <p>"+e.costo+"€ "+e.tipo+"</p>                                   <div class='modifica-mezzo'>                                     <span class='fui-new'></span>                                     <span class='fui-cross'></span>                                   </div>                               </div>";$("#abbonamenti-container").append(t);$(".fui-cross").click(function(e){var t=$(this),n=t.parents(".tabella-mezzo:first").attr("id");$("#"+n).remove();$.each(array_abbonamenti,function(e,t){t.id_abbonamento==n&&array_abbonamenti.splice(array_abbonamenti.indexOf(t),1)})});$(".fui-new").click(function(e){var t=$(this),n=t.parents(".tabella-mezzo:first").attr("id");$.each(array_abbonamenti,function(e,t){if(t.id_abbonamento==n){old_abbonamento_id=t.id_abbonamento;load_form_abbonamento_data(array_abbonamenti[array_abbonamenti.indexOf(t)])}});edit_mode=!0})}function load_abbonamenti_data(){if(!$.isEmptyObject(user_current_data.abbonamenti)){array_abbonamenti=user_current_data.abbonamenti;$.each(array_abbonamenti,function(e,t){add_abbonamento(t)})}}function load_form_abbonamento_data(e){$("#aggiungi-abbonamento").show();$("select[name=abbonamento_nome]").val(e.abbonamento_nome).change();$("select[name=tipo]").val(e.tipo).change();$("input[name=costo]").val(e.costo)}function load_form_spostamenti(){toggle_active_menu("#menu-spostamenti-button");load_partial("partials/spostamenti.html","#form-container",function(){form_spostamenti()})}function form_spostamenti(){$(".form-campi").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"}});$("label").tooltip();$("select").selectpicker({style:"btn-hg btn-primary",menuStyle:"dropdown-inverse"});$(".switch").bootstrapSwitch();laod_spostamenti_data();user_current_data.spostamenti=array_spostamenti;load_mezzi();$("#bottone-aggiungi-spostamento").click(function(){$("#aggiungi-spostamento").show()});$("#salva-spostamento").click(function(){$(".form-campi").data("bootstrapValidator").validate();if($(".form-campi").data("bootstrapValidator").isValid()){var e={};$.each($("#spostamenti-caller").serializeArray(),function(t,n){e[n.name]=n.value});e.id_spostamento=generete_id();if(edit_mode){$("#"+old_spostamento_id).remove();$.each(array_spostamenti,function(e,t){t.id_spostamento==old_spostamento_id&&array_spostamenti.splice(array_spostamenti.indexOf(t),1)});edit_mode=!1}array_spostamenti.push(e);add_spostamento(e);reset_form("#spostamenti-caller");$("#aggiungi-spostamento").hide()}});$("#cancel-spostamento").click(function(){edit_mode=!1;old_spostamento_id="";reset_form("#spostamenti-caller");$("#aggiungi-spostamento").hide()});$("#spostamenti-avanti").click(function(){if(array_spostamenti.length>0){user_current_data.id_location=generete_id();get_results_from_user_data(user_current_data,function(e){user_current_data.risultati=e;if(tile_edit_mode==1){$("#"+tile_old_id).remove();remove_comparison_chart(tile_old_id);tile_edit_mode=!1;tile_old_id=""}else user_data.push(user_current_data);add_box_risultati(user_current_data);save_user_data(user_data);user_current_data={};array_auto=[];array_spostamenti=[];array_abbonamenti=[];close_form_sidebar()})}})}function add_spostamento(e){var t="<div id='"+e.id_spostamento+"' class='tabella-attivita'>                                 <h3 class='nome-attivita'>"+e.descrizione+"</h3>                                 <p>"+e.motivo+", "+e.percorrenze+" volte a settimana</p>                                 <div class='modifica-attivita'>                                     <span class='fui-new'></span>                                     <span class='fui-cross'></span>                                 </div>                               </div>";$("#spostamenti-container").append(t);$(".fui-cross").click(function(e){var t=$(this),n=t.parents(".tabella-attivita:first").attr("id");console.log(n);$("#"+n).remove();$.each(array_spostamenti,function(e,t){t.id_spostamento==n&&array_spostamenti.splice(array_spostamenti.indexOf(t),1)})});$(".fui-new").click(function(e){var t=$(this),n=t.parents(".tabella-attivita:first").attr("id");$.each(array_spostamenti,function(e,t){if(t.id_spostamento==n){old_spostamento_id=t.id_spostamento;load_form_spostamenti_data(array_spostamenti[array_spostamenti.indexOf(t)])}});edit_mode=!0})}function laod_spostamenti_data(){if(!$.isEmptyObject(user_current_data.spostamenti)){array_spostamenti=user_current_data.spostamenti;$.each(user_current_data.spostamenti,function(e,t){add_spostamento(t)})}}function load_mezzi(){$.isEmptyObject(user_current_data.automobili)||$.each(user_current_data.automobili,function(e,t){$("select[name=id_mezzo]").append("<option value='"+t.id_auto+"'>"+t.auto_nome+"</option>")});$.isEmptyObject(user_current_data.abbonamenti)||$.each(user_current_data.abbonamenti,function(e,t){$("select[name=id_mezzo]").append("<option value='"+t.id_abbonamento+"'>"+t.abbonamento_nome+"</option>")})}function load_form_spostamenti_data(e){$("select[name=motivo]").val(e.motivo).change();$("input[name=descrizione]").val(e.descrizione);$("input[name=percorrenze]").val(e.percorrenze);$("input[name=tempo]").val(e.tempo);$("input[name=distanza]").val(e.distanza);$("select[name=id_auto]").val(e.id_auto).change();$("#aggiungi-spostamento").show()}function add_box_risultati(e){var t={id_location:e.id_location,costo_residenza:parseFloat(e.risultati.costo_residenza).toFixed(2),indirizzo:e.abitazione.indirizzo,costo_auto:parseFloat(e.risultati.costo_auto).toFixed(2),costi_fissi_auto:parseFloat(e.risultati.costi_fissi_auto).toFixed(2),costo_trasporto_pubblico:parseFloat(e.risultati.costo_trasporto_pubblico).toFixed(2),costo_totale_annuale:(parseFloat(e.risultati.costo_residenza)+parseFloat(e.risultati.costo_auto)+parseFloat(e.risultati.costi_fissi_auto)+parseFloat(e.risultati.costo_trasporto_pubblico)).toFixed(2),tempo_speso:e.risultati.tempo_speso};$.get("/partials/risultato.html",function(e){var n=Mustache.render(e,t);$("#container-risultato").append(n);create_chart(t);$(".fui-cross").click(function(e){var t=$(this),n=t.parents(".tile-risultato:first").attr("id");remove_tile_with_id(n);$("#"+n).remove();remove_comparison_chart(n);save_user_data(user_data)});$(".fui-new").click(function(e){var t=$(this),n=t.parents(".tile-risultato:first").attr("id");tile_edit_mode=!0;user_current_data=find_user_data_with_id(n);tile_old_id=user_current_data.id_location;open_form_sidebar()})});if($("#container-confronto").children().length>0){creare_comparison_chart(t);$("#container-confronto").show()}else load_partial("partials/confronto.html","#container-confronto",function(){creare_comparison_chart(t)})}function creare_comparison_chart(e){var t={id_grafico_confronto:e.id_location+"-grafico-confronto"};$.get("/partials/grafico-confronto.html",function(n){var r=Mustache.render(n,t);$("#confronto-grafici-container").append(r);var i=parseFloat(e.costo_auto)+parseFloat(e.costo_residenza)+parseFloat(e.costo_trasporto_pubblico),s=e.costo_residenza/i*100,o=e.costo_auto/i*100,u=e.costo_trasporto_pubblico/i*100;console.log(e.id_location);$("#"+e.id_location+"-grafico-confronto").children(".residenza-grafico").css("height",s+"%");$("#"+e.id_location+"-grafico-confronto").children(".auto-grafico").css("height",o+"%");$("#"+e.id_location+"-grafico-confronto").children(".trasporti-grafico").css("height",u+"%");$("#confronto-grafici-testo").append('<div id="'+e.id_location+'-didascalia" class="confronto-didascalia">'+e.indirizzo+"</div>")})}function remove_comparison_chart(e){$("#"+e+"-grafico-confronto").remove();$("#"+e+"-didascalia").remove();$("#confronto-grafici-container").children().length>0||$("#container-confronto").hide()}function create_chart(e){var t=$("#"+e.id_location+" .chart"),n=$(t)[0].getContext("2d"),e=[{value:parseFloat(e.costo_residenza),color:"#2C3E4E"},{value:parseFloat(e.costo_auto),color:"#9B59B6"},{value:parseFloat(e.costo_trasporto_pubblico),color:"#36CC71"}],r={animationSteps:70,animationEasing:"easeInOutQuart",animateScale:!1,segmentShowStroke:!0,segmentStrokeColor:"#ECF0F1"};(new Chart(n)).Doughnut(e,r)}function find_user_data_with_id(e){var t={};$.each(user_data,function(n,r){r.id_location==e&&(t=r)});return t}function remove_tile_with_id(e){$.each(user_data,function(t,n){n.id_location==e&&user_data.splice(user_data.indexOf(n),1)})}$("#new-session").click(function(){new_session()});$("#welcome-avanti").click(function(){new_session()});$("#menu-famiglia-button").click(function(){load_form_famiglia()});var comune="",zona="",categoria="",costo_min=0,costo_max=0,costo=0;$("#menu-abitazione-button").click(function(){load_form_abitazione("#menu-abitazione-button")});var classe="",alimentazione="",array_auto=[],array_abbonamenti=[],old_auto_id="",old_abbonamento_id="";$("#menu-trasporti-button").click(function(){load_form_trasporti()});var array_spostamenti=[],old_spostamento_id="";$("#menu-spostamenti-button").click(function(){load_form_spostamenti()});
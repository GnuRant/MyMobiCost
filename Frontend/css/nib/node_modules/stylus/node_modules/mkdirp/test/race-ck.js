var mkdirp=require("../").mkdirp,path=require("path"),fs=require("fs"),test=require("tap").test;test("race",function(e){function o(t,n){mkdirp(t,493,function(r){r?e.fail(r):path.exists(t,function(r){r?fs.stat(t,function(t,r){if(t)e.fail(t);else{e.equal(r.mode&511,493);e.ok(r.isDirectory(),"target not a directory");n&&n()}}):e.fail("file not created")})})}e.plan(4);var t=["","tmp"];for(var n=0;n<25;n++){var r=Math.floor(Math.random()*Math.pow(16,4)).toString(16);t.push(r)}var i=t.join("/"),s=2;o(i,function(){--s===0&&e.end()});o(i,function(){--s===0&&e.end()})});